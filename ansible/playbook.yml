# ansible/playbook.yml
---
- name: Configurações base para todas as máquinas
  hosts: todos
  become: true
  gather_facts: true
  roles:
    - role: sistema

- name: Configurações do Load Balancer e geração das chaves dos CAs
  hosts: loadbalancers
  become: true
  gather_facts: true
  vars_files:
    - vars/lb.yml
    - vars/cert.yml
    - vars/k8s.yml
  roles:
    - role: tls-ca
    - role: haproxy

- name: Configurar nodes Kubernetes (comum para workers e managers)
  hosts: k8s_nodes
  become: true
  gather_facts: true
  vars_files:
    - vars/cert.yml
  roles:
    - role: k8s-base
    - role: tls-certs
      tags: ['certs-kubelet']

- name: Configurar Kubernetes Control Planes
  hosts: managers
  become: true
  gather_facts: true
  vars_files:
    - vars/cert.yml
  roles:
    - role: tls-certs
      run_once: true
      tags: ['certs-apiserver']

# - name: Configurar Kubernetes Workers
#   hosts: workers
#   become: true
#   roles:
#     - sistema